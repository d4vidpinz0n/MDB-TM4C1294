


ARM Macro Assembler    Page 1 


    1 00000000         ; PortD.s
    2 00000000         ; Runs on TM4C1294
    3 00000000         ; Configura el puertoD para funcionar con un teclado mat
                       ricial de 4x4
    4 00000000         ; Configura los pines D0-D3 como entrada y D4-D7 como sa
                       lida
    5 00000000         ; activa pull-up para los pines de entrada
    6 00000000         ; activa interrupciones por down_edge en pines D0-D3
    7 00000000         ; conexiones:
    8 00000000         ;  1 2 3 4 5 6 7 8
    9 00000000         ;  D2 D0 D1 D3 D6 D7 D4 D5
   10 00000000         ; David Pinzon
   11 00000000         ; May 28, 2017
   12 00000000         
   13 00000000         ;THIS SOFTWARE IS PROVIDED "AS IS".  NO WARRANTIES, WHET
                       HER EXPRESS, IMPLIED
   14 00000000         ;OR STATUTORY, INCLUDING, BUT NOT LIMITED TO, IMPLIED WA
                       RRANTIES OF
   15 00000000         ;MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE AP
                       PLY TO THIS SOFTWARE.
   16 00000000         ;VALVANO SHALL NOT, IN ANY CIRCUMSTANCES, BE LIABLE FOR 
                       SPECIAL, INCIDENTAL,
   17 00000000         ;OR CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.
   18 00000000         
   19 00000000 4005B000 
                       GPIO_PORTD_DATA
                               EQU              0x4005B000  ;GPIO Data
   20 00000000         
   21 00000000 4005B03C 
                       GPIO_PORTD_0123
                               EQU              0x4005B03C  ;GPIO PORTD Mask D0
                                                            ,D1,D2,D3
   22 00000000 4005B3C0 
                       GPIO_PORTD_4567
                               EQU              0x4005B3C0  ;GPIO PORTD Mask D4
                                                            ,D5,D6,D7
   23 00000000         
   24 00000000 4005B400 
                       GPIO_PORTD_DIR
                               EQU              0x4005B400  ;GPIO Dir
   25 00000000 4005B404 
                       GPIO_PORTD_IS
                               EQU              0x4005B404  ;GPIO Interrupt Sen
                                                            se
   26 00000000 4005B408 
                       GPIO_PORTD_IBE
                               EQU              0x4005B408  ;GPIO Interrupt Bot
                                                            h Edges
   27 00000000 4005B40C 
                       GPIO_PORTD_IEV
                               EQU              0x4005B40C  ;GPIO Interrupt Eve
                                                            nt
   28 00000000 4005B410 
                       GPIO_PORTD_IM
                               EQU              0x4005B410  ;GPIO Interrupt Mas
                                                            k
   29 00000000 4005B414 
                       GPIO_PORTD_RIS
                               EQU              0x4005B414  ;GPIO Raw Interrupt



ARM Macro Assembler    Page 2 


                                                             Status
   30 00000000 4005B418 
                       GPIO_PORTD_MIS
                               EQU              0x4005B418  ;GPIO Masked Interr
                                                            upt Status
   31 00000000 4005B41C 
                       GPIO_PORTD_ICR
                               EQU              0x4005B41C  ;GPIO Interrupt Cle
                                                            ar
   32 00000000 4005B420 
                       GPIO_PORTD_AFSEL
                               EQU              0x4005B420  ;GPIO Alternate Fun
                                                            ction
   33 00000000 4005B510 
                       GPIO_PORTD_PUR
                               EQU              0x4005B510  ;GPIO Pull-Up Selec
                                                            t
   34 00000000 4005B514 
                       GPIO_PORTD_PDR
                               EQU              0x4005B514  ;GPIO Pull-Down Sel
                                                            ect
   35 00000000 4005B51C 
                       GPIO_PORTD_DEN
                               EQU              0x4005B51C  ;GPIO Digital Enabl
                                                            e
   36 00000000 4005B528 
                       GPIO_PORTD_AMSEL
                               EQU              0x4005B528  ;GPIO Analog Mode S
                                                            elect
   37 00000000 4005B52C 
                       GPIO_PORTD_PCTL
                               EQU              0x4005B52C  ;GPIO Port Control
   38 00000000 4005B538 
                       GPIO_PORTD_SI
                               EQU              0x4005B538  ;GPIO Select Interr
                                                            upt
   39 00000000         
   40 00000000 400FE608 
                       SYSCTL_RCGCGPIO_R
                               EQU              0x400FE608  ;General-Purpose In
                                                            put/Output Run Mode
                                                             Clock Gating Contr
                                                            ol
   41 00000000 400FEA08 
                       SYSCTL_PRGPIO_R
                               EQU              0x400FEA08  ;General-Purpose In
                                                            put/Output Peripher
                                                            al Ready
   42 00000000         
   43 00000000 00000008 
                       SYSCTL_RCGCGPIO_R3
                               EQU              0x00000008  ;GPIO Port D Run Mo
                                                            de Clock Gating Con
                                                            trol
   44 00000000 00000008 
                       SYSCTL_PRGPIO_R3
                               EQU              0x00000008  ;GPIO Port D Periph
                                                            eral Ready
   45 00000000         



ARM Macro Assembler    Page 3 


   46 00000000         
   47 00000000         
   48 00000000         ;functions to export
   49 00000000                 EXPORT           InitPortD
   50 00000000                 EXPORT           PORTD_Handler
   51 00000000         
   52 00000000                 AREA             |.text|, CODE, READONLY, ALIGN=
2
   53 00000000                 THUMB
   54 00000000         
   55 00000000         InitPortD
   56 00000000         ; activate clock for Port D
   57 00000000 4923            LDR              R1, =SYSCTL_RCGCGPIO_R ; R1 = S
                                                            YSCTL_RCGCGPIO_R (p
                                                            ointer)
   58 00000002 6808            LDR              R0, [R1]    ; R0 = [R1] (value)
                                                            
   59 00000004 F040 0008       ORR              R0, R0, #SYSCTL_RCGCGPIO_R3 ; R
                                                            0 = R0|SYSCTL_RCGCG
                                                            PIO_R3
   60 00000008 6008            STR              R0, [R1]    ; [R1] = R0
   61 0000000A         
   62 0000000A         ; allow time for clock to stabilize
   63 0000000A 4922            LDR              R1, =SYSCTL_PRGPIO_R ; R1 = SYS
                                                            CTL_PRGPIO_R (point
                                                            er)
   64 0000000C         GPIOJinitloop
   65 0000000C 6808            LDR              R0, [R1]    ; R0 = [R1] (value)
                                                            
   66 0000000E F010 0008       ANDS             R0, R0, #SYSCTL_PRGPIO_R3 ; R0 
                                                            = R0&SYSCTL_PRGPIO_
                                                            R3
   67 00000012 D0FB            BEQ              GPIOJinitloop ; if(R0 == 0), ke
                                                            ep polling
   68 00000014         
   69 00000014         ; set direction register
   70 00000014 4920            LDR              R1, =GPIO_PORTD_DIR ; R1 = GPIO
                                                            _PORTD_DIR (pointer
                                                            )
   71 00000016 6808            LDR              R0, [R1]    ; R0 = [R1] (value)
                                                            
   72 00000018 F020 000F       BIC              R0, R0, #0x000F ; R0 = R0&~0x0F
                                                             (make D0-D3 in)
   73 0000001C F040 00F0       ORR              R0, R0, #0x00F0 ; R0 = R0&0xF0 
                                                            (make D4-D7 out)
   74 00000020 6008            STR              R0, [R1]    ; [R1] = R0
   75 00000022         
   76 00000022         ;alternative functions select
   77 00000022 491E            LDR              R1, =GPIO_PORTD_AFSEL ; R1 = GP
                                                            IO_PORTD_AFSEL (poi
                                                            nter)
   78 00000024 6808            LDR              R0, [R1]    ; R0 = [R1] (value)
                                                            
   79 00000026 F020 00FF       BIC              R0, R0, #0x00FF ; R0 = R0&~0x00
                                                            FF (disable alterna
                                                            tive functions D0-D
                                                            7)
   80 0000002A 6008            STR              R0, [R1]    ; [R1] = R0
   81 0000002C         



ARM Macro Assembler    Page 4 


   82 0000002C         ; set pull-up register
   83 0000002C 491C            LDR              R1, =GPIO_PORTD_PUR ; R1 = GPIO
                                                            _PORTD_PUR (pointer
                                                            )
   84 0000002E 6808            LDR              R0, [R1]    ; R0 = [R1] (value)
                                                            
   85 00000030 F040 000F       ORR              R0, R0, #0x000F ; R0 = R0|0x0F 
                                                            (enable pull-up on 
                                                            D0-D3)
   86 00000034 6008            STR              R0, [R1]    ; [R1] = R0
   87 00000036         
   88 00000036         ; set digital enable register
   89 00000036 491B            LDR              R1, =GPIO_PORTD_DEN ; R1 = GPIO
                                                            _PORTD_DEN (pointer
                                                            )
   90 00000038 6808            LDR              R0, [R1]    ; R0 = [R1] (value)
                                                            
   91 0000003A F040 00FF       ORR              R0, R0, #0x00FF ; R0 = R0|0xFF 
                                                            (enable digital I/O
                                                             on D0-D7)
   92 0000003E 6008            STR              R0, [R1]    ; [R1] = R0
   93 00000040         
   94 00000040         ; analog mode select register
   95 00000040 4919            LDR              R1, =GPIO_PORTD_AMSEL ; R1 = GP
                                                            IO_PORTD_AMSEL (poi
                                                            nter)
   96 00000042 6808            LDR              R0, [R1]    ; R0 = [R1] (value)
                                                            
   97 00000044 F020 00FF       BIC              R0, R0, #0x00FF ; R0 = R0&~0xFF
                                                             (disable analog fu
                                                            nctionality on D0-D
                                                            7)
   98 00000048 6008            STR              R0, [R1]    ; [R1] = R0
   99 0000004A         
  100 0000004A         ; interrupt sense
  101 0000004A 4918            LDR              R1,=GPIO_PORTD_IS ; R1 = GPIO_P
                                                            ORTD_IS (pointer)
  102 0000004C 6808            LDR              R0,[R1]     ; R0 = [R1] (value)
                                                            
  103 0000004E F020 000F       BIC              R0, R0, #0x0F ; R0 = R0&~0x0F (
                                                            edge sensitive on D
                                                            0-D3)
  104 00000052 6008            STR              R0,[R1]     ; [R1] = R0
  105 00000054         
  106 00000054         ; interrupt event
  107 00000054 4916            LDR              R1,=GPIO_PORTD_IEV ; R1 = GPIO_
                                                            PORTD_IEV (pointer)
                                                            
  108 00000056 6808            LDR              R0,[R1]     ; R0 = [R1] (value)
                                                            
  109 00000058 F020 000F       BIC              R0, R0, #0x0F ; R0 = R0&~0x0F (
                                                            falling edge on D0-
                                                            D3)
  110 0000005C 6008            STR              R0,[R1]     ; [R1] = R0
  111 0000005E         
  112 0000005E         ; interrupt mask
  113 0000005E 4915            LDR              R1,=GPIO_PORTD_IM ; R1 = GPIO_P
                                                            ORTD_IM (pointer)
  114 00000060 6808            LDR              R0,[R1]     ; R0 = [R1] (value)



ARM Macro Assembler    Page 5 


                                                            
  115 00000062 F040 000F       ORR              R0, R0, #0x0F ; R0 = R0&~0x0F (
                                                            interrupt on D0-D3 
                                                            sent to the control
                                                            ler)
  116 00000066 6008            STR              R0,[R1]     ; [R1] = R0
  117 00000068         
  118 00000068         
  119 00000068         ;---------PORTD_Handler---------
  120 00000068         ; Rutina de interrupcion para detectar tecla presionada
  121 00000068         ; Input : none
  122 00000068         ; Output: none
  123 00000068         ; Modifies: none, all used Register are pushed and poped
                       
  124 00000068         PORTD_Handler
  125 00000068 B503            PUSH             {R0,R1,LR}  ; save current valu
                                                            es of R0,R1,LR
  126 0000006A 4913            LDR              R1,=GPIO_PORTD_RIS ; R1 = &GPIO
                                                            _PORTD_RIS (pointer
                                                            )
  127 0000006C 6808            LDR              R0, [R1]    ; R0 = [R1] (GPIO_P
                                                            ORTD_RIS) 
  128 0000006E         ;check raw interrupt to find the bit interrupt
  129 0000006E 2801            CMP              R0, #0x01   ; R0 == 0x01 ? (D0 
                                                            interrupt)
  130 00000070 D1FF            BNE              handler_check_D1
  131 00000072         ; acknowledge D0 interrupt
  132 00000072         
  133 00000072         handler_check_D1
  134 00000072 2802            CMP              R0, #0x02   ; R0 == 0x02 ? (D1 
                                                            interrupt)
  135 00000074 D1FF            BNE              handler_check_D2
  136 00000076         ; acknowledge D1 interrupt
  137 00000076         handler_check_D2
  138 00000076 2804            CMP              R0, #0x04   ; R0 == 0x04 ? (D2 
                                                            interrupt)
  139 00000078 D1FF            BNE              handler_check_D3
  140 0000007A         ; acknowledge D2 interrupt
  141 0000007A         handler_check_D3
  142 0000007A 2808            CMP              R0, #0x08   ; R0 == 0x08 ? (D3 
                                                            interrupt)
  143 0000007C D1FF            BNE              handler_portd_done
  144 0000007E         ; acknowledge D3 interrupt
  145 0000007E         handler_portd_done
  146 0000007E         ; clear interrupt
  147 0000007E 490F            LDR              R1,=GPIO_PORTD_ICR ; R1 = GPIO_
                                                            PORTD_ICR (pointer)
                                                            
  148 00000080 6808            LDR              R0,[R1]     ; R0 = [R1] (value)
                                                            
  149 00000082 F040 00FF       ORR              R0,R0,#0xFF ; R0 = R0|0x01
  150 00000086 6008            STR              R0,[R1]     ; [R1] = R0
  151 00000088         
  152 00000088 BD03            POP              {R0,R1,PC}  ; restore previuos 
                                                            values
  153 0000008A         
  154 0000008A         ;---------detect_line---------
  155 0000008A         ; Encuentra la line de la tecla presionada
  156 0000008A         ; Input : R0, actual GPIO Raw Interrup Status



ARM Macro Assembler    Page 6 


  157 0000008A         ; Output: none
  158 0000008A         ; Modifies: none, all used Register are pushed and poped
                       
  159 0000008A         detect_line
  160 0000008A B503            PUSH             {R0,R1,LR}  ; save current valu
                                                            es of R0,R1,LR
  161 0000008C BD03            POP              {R0,R1,PC}  ; restore previuos 
                                                            values
  162 0000008E         
  163 0000008E 00 00           ALIGN                        ; make sure the end
                                                             of this section is
                                                             aligned
  164 00000090                 END                          ; end of file
              400FE608 
              400FEA08 
              4005B400 
              4005B420 
              4005B510 
              4005B51C 
              4005B528 
              4005B404 
              4005B40C 
              4005B410 
              4005B414 
              4005B41C 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\portd.d -o.\objects\portd.o -IC:\Users\mode_\Document
s\Fmat\MicroControladores\KeilProjects\Cash_flow\RTE\_Target_1 -IC:\Keil_v5\ARM
\PACK\Keil\TM4C_DFP\1.1.0\Device\Include\TM4C129 -IC:\Keil_v5\ARM\CMSIS\Include
 --predefine="__EVAL SETA 1" --predefine="__UVISION_VERSION SETA 522" --predefi
ne="TM4C1294NCPDT SETA 1" --list=.\listings\portd.lst PortD.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 52 in file PortD.s
   Uses
      None
Comment: .text unused
GPIOJinitloop 0000000C

Symbol: GPIOJinitloop
   Definitions
      At line 64 in file PortD.s
   Uses
      At line 67 in file PortD.s
Comment: GPIOJinitloop used once
InitPortD 00000000

Symbol: InitPortD
   Definitions
      At line 55 in file PortD.s
   Uses
      At line 49 in file PortD.s
Comment: InitPortD used once
PORTD_Handler 00000068

Symbol: PORTD_Handler
   Definitions
      At line 124 in file PortD.s
   Uses
      At line 50 in file PortD.s
Comment: PORTD_Handler used once
detect_line 0000008A

Symbol: detect_line
   Definitions
      At line 159 in file PortD.s
   Uses
      None
Comment: detect_line unused
handler_check_D1 00000072

Symbol: handler_check_D1
   Definitions
      At line 133 in file PortD.s
   Uses
      At line 130 in file PortD.s
Comment: handler_check_D1 used once
handler_check_D2 00000076

Symbol: handler_check_D2
   Definitions
      At line 137 in file PortD.s
   Uses
      At line 135 in file PortD.s
Comment: handler_check_D2 used once
handler_check_D3 0000007A

Symbol: handler_check_D3



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 141 in file PortD.s
   Uses
      At line 139 in file PortD.s
Comment: handler_check_D3 used once
handler_portd_done 0000007E

Symbol: handler_portd_done
   Definitions
      At line 145 in file PortD.s
   Uses
      At line 143 in file PortD.s
Comment: handler_portd_done used once
9 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

GPIO_PORTD_0123 4005B03C

Symbol: GPIO_PORTD_0123
   Definitions
      At line 21 in file PortD.s
   Uses
      None
Comment: GPIO_PORTD_0123 unused
GPIO_PORTD_4567 4005B3C0

Symbol: GPIO_PORTD_4567
   Definitions
      At line 22 in file PortD.s
   Uses
      None
Comment: GPIO_PORTD_4567 unused
GPIO_PORTD_AFSEL 4005B420

Symbol: GPIO_PORTD_AFSEL
   Definitions
      At line 32 in file PortD.s
   Uses
      At line 77 in file PortD.s
Comment: GPIO_PORTD_AFSEL used once
GPIO_PORTD_AMSEL 4005B528

Symbol: GPIO_PORTD_AMSEL
   Definitions
      At line 36 in file PortD.s
   Uses
      At line 95 in file PortD.s
Comment: GPIO_PORTD_AMSEL used once
GPIO_PORTD_DATA 4005B000

Symbol: GPIO_PORTD_DATA
   Definitions
      At line 19 in file PortD.s
   Uses
      None
Comment: GPIO_PORTD_DATA unused
GPIO_PORTD_DEN 4005B51C

Symbol: GPIO_PORTD_DEN
   Definitions
      At line 35 in file PortD.s
   Uses
      At line 89 in file PortD.s
Comment: GPIO_PORTD_DEN used once
GPIO_PORTD_DIR 4005B400

Symbol: GPIO_PORTD_DIR
   Definitions
      At line 24 in file PortD.s
   Uses
      At line 70 in file PortD.s
Comment: GPIO_PORTD_DIR used once
GPIO_PORTD_IBE 4005B408

Symbol: GPIO_PORTD_IBE



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

   Definitions
      At line 26 in file PortD.s
   Uses
      None
Comment: GPIO_PORTD_IBE unused
GPIO_PORTD_ICR 4005B41C

Symbol: GPIO_PORTD_ICR
   Definitions
      At line 31 in file PortD.s
   Uses
      At line 147 in file PortD.s
Comment: GPIO_PORTD_ICR used once
GPIO_PORTD_IEV 4005B40C

Symbol: GPIO_PORTD_IEV
   Definitions
      At line 27 in file PortD.s
   Uses
      At line 107 in file PortD.s
Comment: GPIO_PORTD_IEV used once
GPIO_PORTD_IM 4005B410

Symbol: GPIO_PORTD_IM
   Definitions
      At line 28 in file PortD.s
   Uses
      At line 113 in file PortD.s
Comment: GPIO_PORTD_IM used once
GPIO_PORTD_IS 4005B404

Symbol: GPIO_PORTD_IS
   Definitions
      At line 25 in file PortD.s
   Uses
      At line 101 in file PortD.s
Comment: GPIO_PORTD_IS used once
GPIO_PORTD_MIS 4005B418

Symbol: GPIO_PORTD_MIS
   Definitions
      At line 30 in file PortD.s
   Uses
      None
Comment: GPIO_PORTD_MIS unused
GPIO_PORTD_PCTL 4005B52C

Symbol: GPIO_PORTD_PCTL
   Definitions
      At line 37 in file PortD.s
   Uses
      None
Comment: GPIO_PORTD_PCTL unused
GPIO_PORTD_PDR 4005B514

Symbol: GPIO_PORTD_PDR
   Definitions
      At line 34 in file PortD.s
   Uses



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

      None
Comment: GPIO_PORTD_PDR unused
GPIO_PORTD_PUR 4005B510

Symbol: GPIO_PORTD_PUR
   Definitions
      At line 33 in file PortD.s
   Uses
      At line 83 in file PortD.s
Comment: GPIO_PORTD_PUR used once
GPIO_PORTD_RIS 4005B414

Symbol: GPIO_PORTD_RIS
   Definitions
      At line 29 in file PortD.s
   Uses
      At line 126 in file PortD.s
Comment: GPIO_PORTD_RIS used once
GPIO_PORTD_SI 4005B538

Symbol: GPIO_PORTD_SI
   Definitions
      At line 38 in file PortD.s
   Uses
      None
Comment: GPIO_PORTD_SI unused
SYSCTL_PRGPIO_R 400FEA08

Symbol: SYSCTL_PRGPIO_R
   Definitions
      At line 41 in file PortD.s
   Uses
      At line 63 in file PortD.s
Comment: SYSCTL_PRGPIO_R used once
SYSCTL_PRGPIO_R3 00000008

Symbol: SYSCTL_PRGPIO_R3
   Definitions
      At line 44 in file PortD.s
   Uses
      At line 66 in file PortD.s
Comment: SYSCTL_PRGPIO_R3 used once
SYSCTL_RCGCGPIO_R 400FE608

Symbol: SYSCTL_RCGCGPIO_R
   Definitions
      At line 40 in file PortD.s
   Uses
      At line 57 in file PortD.s
Comment: SYSCTL_RCGCGPIO_R used once
SYSCTL_RCGCGPIO_R3 00000008

Symbol: SYSCTL_RCGCGPIO_R3
   Definitions
      At line 43 in file PortD.s
   Uses
      At line 59 in file PortD.s
Comment: SYSCTL_RCGCGPIO_R3 used once
22 symbols



ARM Macro Assembler    Page 4 Alphabetic symbol ordering
Absolute symbols

367 symbols in table
